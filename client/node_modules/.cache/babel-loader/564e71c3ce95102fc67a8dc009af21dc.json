{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar react_1 = __importDefault(require(\"react\"));\n\nvar prop_types_1 = __importDefault(require(\"prop-types\"));\n\nvar mousetrap_1 = __importDefault(require(\"mousetrap\"));\n\nvar lodash_isequal_1 = __importDefault(require(\"lodash.isequal\"));\n\nfunction getSequencesFromMap(hotKeyMap, hotKeyName) {\n  var sequences = hotKeyMap[hotKeyName];\n  var result = [];\n\n  if (!sequences) {\n    return [hotKeyName];\n  }\n\n  return result.concat(sequences);\n}\n\nvar HotKeys = function (_super) {\n  __extends(HotKeys, _super);\n\n  function HotKeys(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.wrappedComponent = react_1.default.createRef();\n\n    _this.focus = function (preLocation) {\n      if (_this.wrappedComponent.current) {\n        _this.wrappedComponent.current.focus();\n\n        if (_this.props.onNavigateIn) {\n          _this.props.onNavigateIn(preLocation);\n        }\n      }\n    };\n\n    _this.navigateTo = function (target) {\n      var to = function (next) {\n        var targetComponent = _this.hotKeyChain.find(function (instance) {\n          var dom = instance.wrappedComponent.current;\n\n          if (dom) {\n            var style = window.getComputedStyle(dom);\n            return instance.name === next && style.visibility !== 'hidden';\n          }\n\n          return false;\n        });\n\n        if (targetComponent) {\n          targetComponent.focus(_this.props.name);\n          return true;\n        }\n\n        return false;\n      };\n\n      if (target) {\n        if (_this.props.onNavigateOut) {\n          _this.props.onNavigateOut();\n        }\n\n        if (typeof target === 'string') {\n          to(target);\n        } else {\n          target.some(function (t) {\n            return to(t);\n          });\n        }\n      }\n    };\n\n    _this.onFocus = function (e) {\n      if (_this.props.onFocus) {\n        _this.props.onFocus(e);\n      }\n\n      if (e.target === _this.wrappedComponent.current) {\n        _this.setFocus();\n      }\n    };\n\n    _this.name = props.name;\n    _this.focusOnMount = !!props.focusOnMount;\n    return _this;\n  }\n\n  HotKeys.prototype.getChildContext = function () {\n    return {\n      hotKeyParent: this,\n      hotKeyMap: this.hotKeyMap\n    };\n  };\n\n  HotKeys.prototype.componentWillMount = function () {\n    this.updateMap();\n\n    if (this.context.hotKeyParent) {\n      this.hotKeyChain = this.context.hotKeyParent.hotKeyChain;\n      this.hotKeyChain.push(this);\n    } else {\n      this.hotKeyChain = [this];\n    }\n  };\n\n  HotKeys.prototype.componentDidMount = function () {\n    if (this.wrappedComponent.current) {\n      this.mousetrap = new mousetrap_1.default(this.wrappedComponent.current);\n    }\n\n    this.updateHotKeys(true);\n    this.mounted = true;\n    var lastNodeInChain;\n\n    if (this.hotKeyChain) {\n      lastNodeInChain = this.hotKeyChain[this.hotKeyChain.length - 1];\n    }\n\n    if (this.props.focusOnMount && this === lastNodeInChain && this.wrappedComponent.current) {\n      this.wrappedComponent.current.focus();\n    }\n  };\n\n  HotKeys.prototype.setFocus = function () {\n    this.hotKeyChain.forEach(function (h) {\n      if (h.focused) {\n        h.focused = false;\n        h.previousFocused = true;\n      } else if (h.previousFocused) {\n        h.previousFocused = false;\n      }\n    });\n    this.focused = true;\n    this.previousFocused = false;\n  };\n\n  HotKeys.prototype.componentDidUpdate = function (prevProps) {\n    this.updateHotKeys(false, prevProps);\n  };\n\n  HotKeys.prototype.componentWillUnmount = function () {\n    var _this = this;\n\n    if (this.mousetrap) {\n      this.mousetrap.reset();\n    }\n\n    this.mounted = false;\n\n    if (this.hotKeyChain) {\n      this.hotKeyChain.splice(this.hotKeyChain.indexOf(this), 1);\n    }\n\n    setTimeout(function () {\n      _this.hotKeyChain.forEach(function (h) {\n        var _a;\n\n        if (h.previousFocused) {\n          (_a = h.wrappedComponent.current) === null || _a === void 0 ? void 0 : _a.focus();\n        }\n      });\n    });\n  };\n\n  HotKeys.prototype.buildMap = function () {\n    var parentMap = this.context.hotKeyMap || {};\n    var thisMap = this.props.keyMap || {};\n    return __assign(__assign({}, parentMap), thisMap);\n  };\n\n  HotKeys.prototype.updateMap = function () {\n    var newMap = this.buildMap();\n\n    if (!lodash_isequal_1.default(newMap, this.hotKeyMap)) {\n      this.hotKeyMap = newMap;\n      return true;\n    }\n\n    return false;\n  };\n\n  HotKeys.prototype.updateHotKeys = function (force, prevProps) {\n    var _this = this;\n\n    if (force === void 0) {\n      force = false;\n    }\n\n    var handlers = this.props.handlers || {};\n    var navigator = this.props.navigator || {};\n    var prevHandlers = prevProps && prevProps.handlers || handlers;\n\n    if (!force && lodash_isequal_1.default(handlers, prevHandlers) && !this.updateMap()) {\n      return;\n    }\n\n    var allSequenceHandlers = [];\n    Object.keys(handlers).concat(Object.keys(navigator)).forEach(function (hotKey) {\n      var sequences = getSequencesFromMap(_this.hotKeyMap, hotKey);\n      var handler = handlers[hotKey];\n      var navigatorHandler = navigator[hotKey];\n      var sequenceHandlers = sequences.map(function (seq) {\n        var combo, eventType, callback;\n\n        if (typeof seq === 'string' || Array.isArray(seq)) {\n          combo = seq;\n        } else if (seq) {\n          combo = seq.combo;\n          eventType = seq.eventType;\n        } else {\n          return;\n        }\n\n        if (!navigatorHandler) {\n          callback = handler;\n        } else {\n          callback = function (e, combo) {\n            if (typeof navigatorHandler === 'string' || Array.isArray(navigatorHandler)) {\n              var target = navigatorHandler;\n\n              _this.navigateTo(target);\n            } else {\n              var target = navigatorHandler(_this);\n\n              _this.navigateTo(target);\n            }\n\n            if (handler) {\n              return handler(e, combo);\n            } else {\n              return false;\n            }\n          };\n        }\n\n        return {\n          callback: callback,\n          eventType: eventType,\n          combo: combo\n        };\n      });\n      allSequenceHandlers = allSequenceHandlers.concat(sequenceHandlers);\n    });\n    this.mousetrap.reset();\n    allSequenceHandlers.forEach(function (handler) {\n      if (handler) {\n        _this.mousetrap.bind(handler.combo, handler.callback, handler.eventType);\n      }\n    });\n  };\n\n  HotKeys.prototype.render = function () {\n    var _a = this.props,\n        navigator = _a.navigator,\n        children = _a.children,\n        keyMap = _a.keyMap,\n        handlers = _a.handlers,\n        focusOnMount = _a.focusOnMount,\n        onNavigateIn = _a.onNavigateIn,\n        onNavigateOut = _a.onNavigateOut,\n        onFocus = _a.onFocus,\n        props = __rest(_a, [\"navigator\", \"children\", \"keyMap\", \"handlers\", \"focusOnMount\", \"onNavigateIn\", \"onNavigateOut\", \"onFocus\"]);\n\n    return react_1.default.createElement(\"div\", __assign({}, props, {\n      onFocus: this.onFocus,\n      ref: this.wrappedComponent,\n      tabIndex: -1\n    }), children);\n  };\n\n  HotKeys.contextTypes = {\n    hotKeyParent: prop_types_1.default.any,\n    hotKeyMap: prop_types_1.default.object\n  };\n  HotKeys.childContextTypes = {\n    hotKeyParent: prop_types_1.default.any,\n    hotKeyMap: prop_types_1.default.object\n  };\n  HotKeys.defaultProps = {\n    focusOnMount: true\n  };\n  return HotKeys;\n}(react_1.default.Component);\n\nexports.HotKeys = HotKeys;\nexports.default = HotKeys;","map":{"version":3,"sources":["../src/HotKeys.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar react_1 = __importDefault(require(\"react\"));\nvar prop_types_1 = __importDefault(require(\"prop-types\"));\nvar mousetrap_1 = __importDefault(require(\"mousetrap\"));\nvar lodash_isequal_1 = __importDefault(require(\"lodash.isequal\"));\nfunction getSequencesFromMap(hotKeyMap, hotKeyName) {\n    var sequences = hotKeyMap[hotKeyName];\n    var result = [];\n    if (!sequences) {\n        return [hotKeyName];\n    }\n    return result.concat(sequences);\n}\nvar HotKeys = (function (_super) {\n    __extends(HotKeys, _super);\n    function HotKeys(props) {\n        var _this = _super.call(this, props) || this;\n        _this.wrappedComponent = react_1.default.createRef();\n        _this.focus = function (preLocation) {\n            if (_this.wrappedComponent.current) {\n                _this.wrappedComponent.current.focus();\n                if (_this.props.onNavigateIn) {\n                    _this.props.onNavigateIn(preLocation);\n                }\n            }\n        };\n        _this.navigateTo = function (target) {\n            var to = function (next) {\n                var targetComponent = _this.hotKeyChain.find(function (instance) {\n                    var dom = instance.wrappedComponent.current;\n                    if (dom) {\n                        var style = window.getComputedStyle(dom);\n                        return instance.name === next && style.visibility !== 'hidden';\n                    }\n                    return false;\n                });\n                if (targetComponent) {\n                    targetComponent.focus(_this.props.name);\n                    return true;\n                }\n                return false;\n            };\n            if (target) {\n                if (_this.props.onNavigateOut) {\n                    _this.props.onNavigateOut();\n                }\n                if (typeof target === 'string') {\n                    to(target);\n                }\n                else {\n                    target.some(function (t) { return to(t); });\n                }\n            }\n        };\n        _this.onFocus = function (e) {\n            if (_this.props.onFocus) {\n                _this.props.onFocus(e);\n            }\n            if (e.target === _this.wrappedComponent.current) {\n                _this.setFocus();\n            }\n        };\n        _this.name = props.name;\n        _this.focusOnMount = !!props.focusOnMount;\n        return _this;\n    }\n    HotKeys.prototype.getChildContext = function () {\n        return {\n            hotKeyParent: this,\n            hotKeyMap: this.hotKeyMap,\n        };\n    };\n    HotKeys.prototype.componentWillMount = function () {\n        this.updateMap();\n        if (this.context.hotKeyParent) {\n            this.hotKeyChain = this.context.hotKeyParent.hotKeyChain;\n            this.hotKeyChain.push(this);\n        }\n        else {\n            this.hotKeyChain = [this];\n        }\n    };\n    HotKeys.prototype.componentDidMount = function () {\n        if (this.wrappedComponent.current) {\n            this.mousetrap = new mousetrap_1.default(this.wrappedComponent.current);\n        }\n        this.updateHotKeys(true);\n        this.mounted = true;\n        var lastNodeInChain;\n        if (this.hotKeyChain) {\n            lastNodeInChain = this.hotKeyChain[this.hotKeyChain.length - 1];\n        }\n        if (this.props.focusOnMount && this === lastNodeInChain && this.wrappedComponent.current) {\n            this.wrappedComponent.current.focus();\n        }\n    };\n    HotKeys.prototype.setFocus = function () {\n        this.hotKeyChain.forEach(function (h) {\n            if (h.focused) {\n                h.focused = false;\n                h.previousFocused = true;\n            }\n            else if (h.previousFocused) {\n                h.previousFocused = false;\n            }\n        });\n        this.focused = true;\n        this.previousFocused = false;\n    };\n    HotKeys.prototype.componentDidUpdate = function (prevProps) {\n        this.updateHotKeys(false, prevProps);\n    };\n    HotKeys.prototype.componentWillUnmount = function () {\n        var _this = this;\n        if (this.mousetrap) {\n            this.mousetrap.reset();\n        }\n        this.mounted = false;\n        if (this.hotKeyChain) {\n            this.hotKeyChain.splice(this.hotKeyChain.indexOf(this), 1);\n        }\n        setTimeout(function () {\n            _this.hotKeyChain.forEach(function (h) {\n                var _a;\n                if (h.previousFocused) {\n                    (_a = h.wrappedComponent.current) === null || _a === void 0 ? void 0 : _a.focus();\n                }\n            });\n        });\n    };\n    HotKeys.prototype.buildMap = function () {\n        var parentMap = this.context.hotKeyMap || {};\n        var thisMap = this.props.keyMap || {};\n        return __assign(__assign({}, parentMap), thisMap);\n    };\n    HotKeys.prototype.updateMap = function () {\n        var newMap = this.buildMap();\n        if (!lodash_isequal_1.default(newMap, this.hotKeyMap)) {\n            this.hotKeyMap = newMap;\n            return true;\n        }\n        return false;\n    };\n    HotKeys.prototype.updateHotKeys = function (force, prevProps) {\n        var _this = this;\n        if (force === void 0) { force = false; }\n        var handlers = this.props.handlers || {};\n        var navigator = this.props.navigator || {};\n        var prevHandlers = (prevProps && prevProps.handlers) || handlers;\n        if (!force && lodash_isequal_1.default(handlers, prevHandlers) && !this.updateMap()) {\n            return;\n        }\n        var allSequenceHandlers = [];\n        Object.keys(handlers)\n            .concat(Object.keys(navigator))\n            .forEach(function (hotKey) {\n            var sequences = getSequencesFromMap(_this.hotKeyMap, hotKey);\n            var handler = handlers[hotKey];\n            var navigatorHandler = navigator[hotKey];\n            var sequenceHandlers = sequences.map(function (seq) {\n                var combo, eventType, callback;\n                if (typeof seq === 'string' || Array.isArray(seq)) {\n                    combo = seq;\n                }\n                else if (seq) {\n                    combo = seq.combo;\n                    eventType = seq.eventType;\n                }\n                else {\n                    return;\n                }\n                if (!navigatorHandler) {\n                    callback = handler;\n                }\n                else {\n                    callback = function (e, combo) {\n                        if (typeof navigatorHandler === 'string' || Array.isArray(navigatorHandler)) {\n                            var target = navigatorHandler;\n                            _this.navigateTo(target);\n                        }\n                        else {\n                            var target = navigatorHandler(_this);\n                            _this.navigateTo(target);\n                        }\n                        if (handler) {\n                            return handler(e, combo);\n                        }\n                        else {\n                            return false;\n                        }\n                    };\n                }\n                return { callback: callback, eventType: eventType, combo: combo };\n            });\n            allSequenceHandlers = allSequenceHandlers.concat(sequenceHandlers);\n        });\n        this.mousetrap.reset();\n        allSequenceHandlers.forEach(function (handler) {\n            if (handler) {\n                _this.mousetrap.bind(handler.combo, handler.callback, handler.eventType);\n            }\n        });\n    };\n    HotKeys.prototype.render = function () {\n        var _a = this.props, navigator = _a.navigator, children = _a.children, keyMap = _a.keyMap, handlers = _a.handlers, focusOnMount = _a.focusOnMount, onNavigateIn = _a.onNavigateIn, onNavigateOut = _a.onNavigateOut, onFocus = _a.onFocus, props = __rest(_a, [\"navigator\", \"children\", \"keyMap\", \"handlers\", \"focusOnMount\", \"onNavigateIn\", \"onNavigateOut\", \"onFocus\"]);\n        return (react_1.default.createElement(\"div\", __assign({}, props, { onFocus: this.onFocus, ref: this.wrappedComponent, tabIndex: -1 }), children));\n    };\n    HotKeys.contextTypes = {\n        hotKeyParent: prop_types_1.default.any,\n        hotKeyMap: prop_types_1.default.object,\n    };\n    HotKeys.childContextTypes = {\n        hotKeyParent: prop_types_1.default.any,\n        hotKeyMap: prop_types_1.default.object,\n    };\n    HotKeys.defaultProps = {\n        focusOnMount: true,\n    };\n    return HotKeys;\n}(react_1.default.Component));\nexports.HotKeys = HotKeys;\nexports.default = HotKeys;\n//# sourceMappingURL=HotKeys.js.map"]},"metadata":{},"sourceType":"script"}